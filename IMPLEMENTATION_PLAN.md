# WiFi Sentry - Structural Fixes Implementation Plan

**Target Completion**: 2-3 days for Priority 1-3  
**Sprint**: 1 week for all items

---

## PRIORITY 1: DELETE OBSOLETE FILES (1 hour)

These files are replaced by the Next.js frontend and should be removed.

```bash
# Step 1: Delete old HTML files
rm -f index.html
rm -f login.html
rm -f dashboard.html
rm -f 2fa-verify.html

# Step 2: Delete old JavaScript files
rm -f app.js
rm -f login.js
rm -f dashboard.js
rm -f 2fa-verify.js

# Step 3: Delete old CSS file
rm -f styles.css

# Step 4: Verify deletion
git status
# Should show 9 deleted files

# Step 5: Commit
git add -A
git commit -m "chore: remove obsolete old UI files - using Next.js frontend"
git push origin main
```

---

## PRIORITY 2: FIX HARDCODED API URLS (30 minutes)

Frontend components hardcoded to `localhost:3000` - won't work in production.

### Fix 1: web-app/src/app/page.tsx

**OLD CODE** (Line 14):
```typescript
const API_BASE = 'http://localhost:3000/api';
```

**NEW CODE**:
```typescript
const API_BASE = process.env.NEXT_PUBLIC_API_URL 
  ? `${process.env.NEXT_PUBLIC_API_URL}/api`
  : 'http://localhost:3000/api';
```

---

### Fix 2: web-app/src/components/LiveScanResults.tsx

**OLD CODE** (Lines 37, 70, 84):
```typescript
eventSource = new EventSource('http://localhost:3000/api/monitoring-stream');

const response = await fetch('http://localhost:3000/api/start-monitoring', {

await fetch('http://localhost:3000/api/stop-monitoring', { method: 'POST' });
```

**NEW CODE**:
```typescript
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000';

// Line 37:
eventSource = new EventSource(`${API_URL}/api/monitoring-stream`);

// Line 70:
const response = await fetch(`${API_URL}/api/start-monitoring`, {

// Line 84:
await fetch(`${API_URL}/api/stop-monitoring`, { method: 'POST' });
```

---

### Fix 3: Create web-app/.env.local

**NEW FILE**: `web-app/.env.local`
```
NEXT_PUBLIC_API_URL=http://localhost:3000
```

**For production**, this will be overridden at build time:
```bash
NEXT_PUBLIC_API_URL=https://api.wifisentry.com npm run build
```

---

## PRIORITY 3: FIX PACKAGE.json METADATA (15 minutes)

Next.js still has default metadata.

### Fix 1: web-app/src/app/layout.tsx

**OLD CODE**:
```typescript
export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};
```

**NEW CODE**:
```typescript
export const metadata: Metadata = {
  title: "WiFi Sentry - Advanced WiFi Threat Detection",
  description: "Real-time WiFi monitoring, threat detection, and security analysis with AI-powered research",
  keywords: "WiFi security, threat detection, evil twin, karma attack, WiFi pineapple",
  authors: [{ name: "WiFi Sentry Team" }],
};
```

---

### Fix 2: Update root package.json metadata

**CURRENT** (doesn't hurt but should be cleaned up):
```json
{
  "homepage": "./"
}
```

**REMOVE IT** - This is only for client-only apps:
```bash
# Edit package.json - delete the "homepage" line
```

---

## PRIORITY 4: FIX CONFIGURATION (45 minutes)

Make sure defaults don't pose security risks.

### Fix 1: config.js - Add production requirements

**FILE**: `config.js`

**CHANGE LINES 11-13**:

```javascript
// OLD:
auth: {
    sessionSecret: process.env.SESSION_SECRET || 'super-secret-key-for-dev',
    adminUsername: process.env.ADMIN_USERNAME || 'admin',
    adminPassword: process.env.ADMIN_PASSWORD || 'password',
}

// NEW:
auth: {
    sessionSecret: process.env.SESSION_SECRET || (() => {
        if (process.env.NODE_ENV === 'production') {
            throw new Error('SESSION_SECRET environment variable is required in production');
        }
        return 'dev-only-secret-key';
    })(),
    adminUsername: process.env.ADMIN_USERNAME || 'admin',
    adminPassword: process.env.ADMIN_PASSWORD || (() => {
        if (process.env.NODE_ENV === 'production') {
            throw new Error('ADMIN_PASSWORD environment variable is required in production');
        }
        return 'dev-password';
    })(),
    adminTwoFactorSecret: process.env.ADMIN_2FA_SECRET || null,
}
```

---

### Fix 2: .env.example - Better comments and organization

**FILE**: `.env.example`

**REPLACE ENTIRE FILE WITH**:
```bash
# =========================================================
# WiFi Sentry Configuration
# For each item, read the description and fill in your value
# =========================================================

# SERVER SETTINGS
# ============================================================
# Port to run the WiFi Sentry backend on
# (only change if 3000 is already in use)
PORT=3000

# NODE environment - set to 'production' for deployment
NODE_ENV=development

# =========================================================
# AUTHENTICATION - REQUIRED FOR ANY DEPLOYMENT
# =========================================================
# These credentials control access to WiFi Sentry dashboard
# 
# IMPORTANT: In production, these MUST be set and be strong!
# You must provide these via environment variables.

# Admin username for dashboard login
ADMIN_USERNAME=admin

# Admin password - CHANGE THIS! Use something strong
# In production, this MUST be provided as an environment variable
ADMIN_PASSWORD=change-me-to-a-secure-password

# Session secret - used to encrypt session cookies
# Generate a random string: openssl rand -hex 32
# In production, this MUST be provided as an environment variable
SESSION_SECRET=your-random-session-secret-here

# 2FA Secret (optional)
# Leave blank to disable 2FA, or set after running setup:2fa
ADMIN_2FA_SECRET=

# =========================================================
# DATABASE - MongoDB
# =========================================================
# Local MongoDB connection (default):
MONGO_URI=mongodb://localhost:27017/wifi-sentry

# MongoDB Atlas (cloud) - replace <user>, <pass>, <cluster>:
# MONGO_URI=mongodb+srv://<user>:<pass>@<cluster>.mongodb.net/wifi-sentry

# =========================================================
# OPTIONAL: GOOGLE GEMINI API (for AI threat analysis)
# =========================================================
# Get your free API key from: https://makersuite.google.com/app/apikey
# Leave blank to disable AI features (app will still work)
GOOGLE_GEMINI_API_KEY=

# Which Gemini model to use (options: gemini-pro, gemini-1.5-pro)
GEMINI_MODEL=gemini-pro

# =========================================================
# OPTIONAL: Google Maps (for location mapping)
# =========================================================
# Get your API key from: https://console.cloud.google.com
# Enable Maps JavaScript API
# Leave blank to disable map features
GOOGLE_MAPS_API_KEY=

# =========================================================
# OPTIONAL: WiGLE.net API (for wardriving export)
# =========================================================
# Create account at: https://wigle.net/
# Get API credentials from: https://wigle.net/account
# Leave blank to disable WiGLE export
WIGLE_API_NAME=
WIGLE_API_TOKEN=

# =========================================================
# OPTIONAL: Firebase (for future cloud features)
# =========================================================
# Not currently used - leave blank
FIREBASE_PROJECT_ID=
FIREBASE_PRIVATE_KEY=
FIREBASE_CLIENT_EMAIL=

# =========================================================
# DEBUGGING (development only)
# =========================================================
DEBUG=false
LOG_LEVEL=info
```

---

### Fix 3: Create .gitignore entries for debug logs

**ADD TO .gitignore**:
```gitignore
# Debug logs
*-debug.log
*.log

# Environment variables (already there)
.env
.env.local
.env.*.local

# OS files
.DS_Store
Thumbs.db
```

---

## PRIORITY 5: CREATE SETUP SCRIPT (1 hour)

One command to setup everything.

### Create: scripts/setup.js

**NEW FILE**:

```javascript
#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');

const isDev = !process.argv.includes('--prod');
const colors = {
  reset: '\x1b[0m',
  green: '\x1b[32m',
  yellow: '\x1b[33m',
  red: '\x1b[31m',
  blue: '\x1b[34m',
};

function log(message, color = 'reset') {
  console.log(`${colors[color]}${message}${colors.reset}`);
}

function logSection(title) {
  console.log('\n' + '='.repeat(60));
  log(title, 'blue');
  console.log('='.repeat(60));
}

function runCommand(cmd, description) {
  try {
    log(`‚è≥ ${description}...`);
    execSync(cmd, { stdio: 'inherit' });
    log(`‚úì ${description}`, 'green');
    return true;
  } catch (error) {
    log(`‚úó ${description} failed`, 'red');
    return false;
  }
}

function fileExists(filePath) {
  return fs.existsSync(filePath);
}

// Main setup
async function setup() {
  log('\nüîß WiFi Sentry Setup\n', 'blue');

  logSection('1. Checking Prerequisites');

  // Check Node version
  try {
    const nodeVersion = execSync('node --version', { encoding: 'utf-8' }).trim();
    const match = nodeVersion.match(/v(\d+)/);
    const majorVersion = parseInt(match[1]);
    
    if (majorVersion < 18) {
      log(`‚úó Node.js 18+ required (you have ${nodeVersion})`, 'red');
      process.exit(1);
    }
    log(`‚úì Node.js ${nodeVersion}`, 'green');
  } catch (error) {
    log('‚úó Node.js not found', 'red');
    process.exit(1);
  }

  logSection('2. Installing Dependencies');

  // Backend dependencies
  if (!runCommand('npm install', 'Installing backend dependencies')) {
    process.exit(1);
  }

  // Frontend dependencies
  if (!runCommand('cd web-app && npm install && cd ..', 'Installing frontend dependencies')) {
    process.exit(1);
  }

  logSection('3. Configuring Environment');

  // Create .env if it doesn't exist
  if (!fileExists('.env')) {
    log('Creating .env file from template...', 'yellow');
    fs.copyFileSync('.env.example', '.env');
    log('‚úì .env file created - EDIT IT NOW with your credentials!', 'yellow');
  } else {
    log('‚úì .env file already exists', 'green');
  }

  // Create web-app/.env.local if it doesn't exist
  if (!fileExists('web-app/.env.local')) {
    log('Creating web-app/.env.local...', 'yellow');
    fs.writeFileSync('web-app/.env.local', 'NEXT_PUBLIC_API_URL=http://localhost:3000\n');
    log('‚úì web-app/.env.local created', 'green');
  } else {
    log('‚úì web-app/.env.local exists', 'green');
  }

  logSection('4. Verification');

  // Check key files exist
  const requiredFiles = [
    'server.js',
    'package.json',
    'web-app/package.json',
    'config.js',
    '.env'
  ];

  let allOk = true;
  for (const file of requiredFiles) {
    if (fileExists(file)) {
      log(`‚úì ${file}`, 'green');
    } else {
      log(`‚úó ${file} missing!`, 'red');
      allOk = false;
    }
  }

  if (!allOk) {
    log('\n‚ö†Ô∏è  Some required files are missing!', 'red');
    process.exit(1);
  }

  logSection('‚úÖ Setup Complete!');
  log('\nNext steps:', 'yellow');
  log('\n1. Edit .env with your credentials:\n   - ADMIN_PASSWORD (required)\n   - SESSION_SECRET (recommended)\n   - GOOGLE_GEMINI_API_KEY (optional)\n', 'reset');
  log('2. Start development:\n   npm run dev:all\n', 'reset');
  log('3. Open:\n   http://localhost:3000\n', 'green');
  log('For more info, see docs/GETTING_STARTED.md\n', 'reset');
}

setup().catch(error => {
  log(`\n‚úó Setup failed: ${error.message}`, 'red');
  process.exit(1);
});
```

---

### Update root package.json scripts

**UPDATE package.json**:

```json
{
  "scripts": {
    "setup": "node scripts/setup.js",
    "setup:prod": "node scripts/setup.js --prod",
    "dev:all": "concurrently \"npm start\" \"npm run web:dev\"",
    "dev:back": "npm run dev",
    "dev:front": "npm run web:dev",
    ...existing scripts...
  },
  "devDependencies": {
    "concurrently": "^8.0.0",
    ...existing deps...
  }
}
```

---

## PRIORITY 6: CREATE DOCUMENTATION STRUCTURE (2 hours)

Organize docs into clear folders.

### Create Folders:

```bash
# Create docs structure
mkdir -p docs/SETUP
mkdir -p docs/DEPLOYMENT
mkdir -p docs/API
mkdir -p docs/COMPONENTS
mkdir -p docs/TROUBLESHOOTING

# Create SETUP guides
touch docs/GETTING_STARTED.md
touch docs/SETUP/development.md
touch docs/SETUP/production.md
touch docs/SETUP/docker.md
touch docs/SETUP/windows-wsl2.md
touch docs/SETUP/android.md

# Create other docs
touch docs/DEPLOYMENT/github-actions.md
touch docs/DEPLOYMENT/docker-compose.md
touch docs/API/rest-api.md
touch docs/COMPONENTS/adapter-settings.md
touch docs/TROUBLESHOOTING/common-issues.md
```

### Move existing docs:

```bash
# Move markdown files to docs/
mv INSTALLATION.md docs/SETUP/
mv WINDOWS_WSL2_MONITORING.md docs/SETUP/
mv DEPLOYMENT_GUIDE.md docs/DEPLOYMENT/
mv GITHUB_ACTIONS_CI_CD.md docs/DEPLOYMENT/
mv ADAPTER_MANAGEMENT.md docs/COMPONENTS/
mv COMPONENT_README.md docs/COMPONENTS/

# Keep in root (or make very brief):
# README.md -> Updated to link to docs/
```

---

## PRIORITY 7: CREATE GETTING STARTED GUIDE (1 hour)

**NEW FILE**: `docs/GETTING_STARTED.md`

```markdown
# Getting Started with WiFi Sentry

Welcome! WiFi Sentry detects WiFi threats in real-time with AI-powered analysis.

## ‚è±Ô∏è Quick Start (5 minutes)

### 1. One-Command Setup

```bash
npm run setup
```

This will:
- Install all dependencies
- Create configuration files
- Check prerequisites

### 2. Configure (2 minutes)

Edit `.env` file:
```bash
nano .env
# or use your favorite editor
```

**Minimum required:**
- `ADMIN_PASSWORD` - Change from default

**Recommended:**
- `GOOGLE_GEMINI_API_KEY` - For AI threat analysis

### 3. Start

```bash
npm run dev:all
```

Opens automatically at: **http://localhost:3000**

### 4. Login

- Username: `admin`
- Password: (whatever you set in .env)

Done! You're running WiFi Sentry.

---

## üìö Choose Your Setup Path

- **Developer**: See [Development Setup](./SETUP/development.md)
- **Production**: See [Production Setup](./SETUP/production.md)
- **Docker**: See [Docker Setup](./SETUP/docker.md)
- **Windows**: See [Windows WSL2 Setup](./SETUP/windows-wsl2.md)
- **Android**: See [Android Setup](./SETUP/android.md)

---

## üêõ Something Not Working?

See [Troubleshooting](./TROUBLESHOOTING/common-issues.md)

## üìñ Full Documentation

- [API Reference](./API/rest-api.md)
- [Component Guide](./COMPONENTS/)
- [Deployment Guide](./DEPLOYMENT/)
```

---

## PRIORITY 8: CREATE .nvmrc

**NEW FILE**: `.nvmrc`

```
18.20.0
```

---

## PRIORITY 9: ADD NODE VERSION CHECK

**UPDATE package.json scripts**:

```json
{
  "scripts": {
    "preinstall": "node scripts/check-node-version.js",
    ...
  }
}
```

**NEW FILE**: `scripts/check-node-version.js`

```javascript
const version = process.versions.node;
const majorVersion = parseInt(version.split('.')[0]);

if (majorVersion < 18) {
  console.error(`‚ùå Node.js 18+ required (you have ${version})`);
  console.error('Update Node.js: https://nodejs.org/');
  process.exit(1);
}
```

---

## EXECUTION ORDER

```
Monday:  Priority 1-3 (1.5 hours)
         - Delete obsolete files
         - Fix API URLs
         - Update metadata
         - Commit & push

Tuesday: Priority 4-5 (1.5 hours)
         - Fix configuration
         - Create setup script
         - Test setup script

Wednesday: Priority 6-9 (2 hours)
           - Create docs structure
           - Write getting started guide
           - Add .nvmrc
           - Final testing

All Fixes: DONE ‚úÖ
Commit: "refactor: restructure project for improved UX and maintainability"
```

---

## VERIFICATION CHECKLIST

After all fixes:

- [ ] Old HTML files deleted (git history shows 9 deletions)
- [ ] Page.tsx uses env var for API URL
- [ ] LiveScanResults.tsx uses env var
- [ ] Layout.tsx metadata updated
- [ ] config.js shows production error for missing secrets
- [ ] .env.example has good comments
- [ ] setup.js works: `npm run setup`
- [ ] `npm run dev:all` starts both backend and frontend
- [ ] http://localhost:3000 is accessible
- [ ] Can login with admin credentials
- [ ] Monitoring works and receives data
- [ ] docs/ folder organized
- [ ] docs/GETTING_STARTED.md is clear and works
- [ ] .nvmrc file present

---

## RESULT

**Before**:
```
Confusing file structure
- Old HTML files in root
- Multiple docs scattered
- Hardcoded URLs
- Complex setup process
```

**After**:
```
Clean, professional structure
‚úì New UI only (Next.js)
‚úì Organized documentation
‚úì Configurable URLs
‚úì One-command setup
‚úì Clear onboarding
```

**User Setup Time**: Reduced from ~15-20 min to ~5 min
**User Confusion**: Dramatically reduced
**First-time Experience**: Professional & smooth
